# TLS Handshake Flow - Detailed Visual Guide

This document provides detailed visual representations of TLS handshake processes for both TLS 1.2 and TLS 1.3.

---

## What is a TLS Handshake?

TLS (Transport Layer Security) is an encryption and authentication protocol designed to secure Internet communications. A TLS handshake is the process that kicks off a communication session that uses TLS. During a TLS handshake, the two communicating sides exchange messages to acknowledge each other, verify each other, establish the cryptographic algorithms they will use, and agree on session keys. TLS handshakes are a foundational part of how HTTPS works.

## TLS vs. SSL Handshakes

SSL (Secure Sockets Layer) was the original security protocol developed for HTTP. SSL was replaced by TLS (Transport Layer Security) some time ago. SSL handshakes are now called TLS handshakes, although the "SSL" name is still in wide use.

## When Does a TLS Handshake Occur?

A TLS handshake takes place whenever a user navigates to a website over HTTPS and the browser first begins to query the website's origin server. A TLS handshake also happens whenever any other communications use HTTPS, including:
- API calls
- DNS over HTTPS queries

**Important:** TLS handshakes occur after a TCP connection has been opened via a TCP handshake.

## What Happens During a TLS Handshake?

During the course of a TLS handshake, the client and server together will do the following:

1. Specify which version of TLS (TLS 1.0, 1.2, 1.3, etc.) they will use
2. Decide on which cipher suites they will use
3. Authenticate the identity of the server via the server's public key and the SSL certificate authority's digital signature
4. Generate session keys in order to use symmetric encryption after the handshake is complete

## Steps of a TLS Handshake

TLS handshakes are a series of datagrams, or messages, exchanged by a client and a server. A TLS handshake involves multiple steps, as the client and server exchange the information necessary for completing the handshake and making further conversation possible.

The exact steps within a TLS handshake will vary depending upon the kind of key exchange algorithm used and the cipher suites supported by both sides.

### RSA Key Exchange Algorithm (TLS 1.2)

The RSA key exchange algorithm, while now considered not secure, was used in versions of TLS before 1.3. It goes roughly as follows:

1. **Client Hello** - The client initiates the handshake by sending a "hello" message to the server. The message will include:
   - TLS version the client supports
   - Cipher suites supported
   - String of random bytes known as the "client random"

2. **Server Hello** - In reply to the client hello message, the server sends a message containing:
   - Server's SSL certificate
   - Server's chosen cipher suite
   - "Server random" (another random string of bytes generated by the server)

3. **Authentication** - The client verifies the server's SSL certificate with the certificate authority that issued it. This confirms that the server is who it says it is, and that the client is interacting with the actual owner of the domain.

4. **Premaster Secret** - The client sends one more random string of bytes, the "premaster secret." The premaster secret is encrypted with the public key and can only be decrypted with the private key by the server. (The client gets the public key from the server's SSL certificate.)

5. **Private Key Used** - The server decrypts the premaster secret.

6. **Session Keys Created** - Both client and server generate session keys from:
   - Client random
   - Server random
   - Premaster secret
   
   They should arrive at the same results.

7. **Client is Ready** - The client sends a "finished" message that is encrypted with a session key.

8. **Server is Ready** - The server sends a "finished" message encrypted with a session key.

9. **Secure Symmetric Encryption Achieved** - The handshake is completed, and communication continues using the session keys.

### Ephemeral Diffie-Hellman Handshake

All TLS handshakes make use of asymmetric cryptography (the public and private key), but not all will use the private key in the process of generating session keys. For instance, an ephemeral Diffie-Hellman handshake proceeds as follows:

1. **Client Hello** - The client sends a client hello message with:
   - Protocol version
   - Client random
   - List of cipher suites

2. **Server Hello** - The server replies with:
   - SSL certificate
   - Selected cipher suite
   - Server random

3. **Server's Digital Signature** - The server computes a digital signature of all the messages up to this point.

4. **Digital Signature Confirmed** - The client verifies the server's digital signature, confirming that the server is who it says it is.

5. **Client DH Parameter** - The client sends its DH parameter to the server.

6. **Client and Server Calculate the Premaster Secret** - Instead of the client generating the premaster secret and sending it to the server (as in an RSA handshake), the client and server use the DH parameters they exchanged to calculate a matching premaster secret separately.

7. **Session Keys Created** - The client and server calculate session keys from the premaster secret, client random, and server random, just like in an RSA handshake.

8. **Client is Ready** - Same as an RSA handshake.

9. **Server is Ready** - Confirmation from server.

10. **Secure Symmetric Encryption Achieved** - Handshake complete.

> **Note:** DH stands for Diffie-Hellman. The Diffie-Hellman algorithm uses exponential calculations to arrive at the same premaster secret. The server and client each provide a parameter for the calculation, and when combined they result in a different calculation on each side, with results that are equal.

## What is Different About a Handshake in TLS 1.3?

TLS 1.3 does not support RSA, nor other cipher suites and parameters that are vulnerable to attack. It also shortens the TLS handshake, making a TLS 1.3 handshake both faster and more secure.

### Basic Steps of a TLS 1.3 Handshake

1. **Client Hello** - The client sends a client hello message with:
   - Protocol version
   - Client random
   - List of cipher suites
   - Parameters that will be used for calculating the premaster secret
   
   Because support for insecure cipher suites has been removed from TLS 1.3, the number of possible cipher suites is vastly reduced. The client hello also includes the parameters that will be used for calculating the premaster secret. Essentially, the client is assuming that it knows the server's preferred key exchange method (which, due to the simplified list of cipher suites, it probably does). This cuts down the overall length of the handshake â€” one of the important differences between TLS 1.3 handshakes and TLS 1.0, 1.1, and 1.2 handshakes.

2. **Server Generates Master Secret** - At this point, the server has received:
   - Client random
   - Client's parameters and cipher suites
   - Server random (generated on its own)
   
   Therefore, the server can create the master secret.

3. **Server Hello and "Finished"** - The server hello includes:
   - Server's certificate
   - Digital signature
   - Server random
   - Chosen cipher suite
   - "Finished" message (because it already has the master secret)

4. **Final Steps and Client "Finished"** - Client:
   - Verifies signature and certificate
   - Generates master secret
   - Sends "Finished" message

5. **Secure Symmetric Encryption Achieved** - Handshake complete.

### 0-RTT Mode for Session Resumption

TLS 1.3 also supports an even faster version of the TLS handshake that does not require any round trips, or back-and-forth communication between client and server, at all.

If the client and the server have connected to each other before (as in, if the user has visited the website before), they can each derive another shared secret from the first session, called the "resumption main secret." The server also sends the client something called a session ticket during this first session.

The client can use this shared secret to send encrypted data to the server on its first message of the next session, along with that session ticket. And TLS resumes between client and server.

## What is a Cipher Suite?

A cipher suite is a set of algorithms for use in establishing a secure communications connection. There are a number of cipher suites in wide use, and an essential part of the TLS handshake is agreeing upon which cipher suite will be used for that handshake.

---

## TLS 1.2 Handshake (Full Detail)

### Complete Message Flow

```
Client (Browser)                           Server (Web Server)
     â”‚                                           â”‚
     â”‚  (1) ClientHello                          â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚  â€¢ Protocol version: TLS 1.2              â”‚
     â”‚  â€¢ Client random (32 bytes)               â”‚
     â”‚  â€¢ Session ID                             â”‚
     â”‚  â€¢ Cipher suites (ordered by preference)  â”‚
     â”‚  â€¢ Compression methods                    â”‚
     â”‚  â€¢ Extensions (SNI, etc.)                 â”‚
     â”‚                                           â”‚
     â”‚                          (2) ServerHello  â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     â€¢ Chosen TLS version  â”‚
     â”‚                     â€¢ Server random       â”‚
     â”‚                     â€¢ Session ID          â”‚
     â”‚                     â€¢ Chosen cipher suite â”‚
     â”‚                     â€¢ Compression method  â”‚
     â”‚                                           â”‚
     â”‚                        (3) Certificate    â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚            â€¢ Server's certificate chain   â”‚
     â”‚            â€¢ X.509 format                â”‚
     â”‚                                           â”‚
     â”‚                  (4) ServerKeyExchange    â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                    (Optional - for DHE)   â”‚
     â”‚              â€¢ Diffie-Hellman parameters  â”‚
     â”‚              â€¢ Signature                  â”‚
     â”‚                                           â”‚
     â”‚                  (5) CertificateRequest   â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                          (Optional - for  â”‚
     â”‚                       client auth)        â”‚
     â”‚                                           â”‚
     â”‚                    (6) ServerHelloDone    â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                           â”‚
     â”œâ”€ Client validates certificate             â”‚
     â”œâ”€ Checks expiration                        â”‚
     â”œâ”€ Verifies domain match                    â”‚
     â”œâ”€ Validates certificate chain              â”‚
     â””â”€ Generates pre-master secret              â”‚
     â”‚                                           â”‚
     â”‚  (7) ClientKeyExchange                    â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚  â€¢ Pre-master secret (encrypted with      â”‚
     â”‚    server's public key from cert)         â”‚
     â”‚                                           â”‚
     â”‚  (8) ChangeCipherSpec                     â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚  â€¢ Notification to switch to encrypted    â”‚
     â”‚                                           â”‚
     â”‚  (9) Finished                             â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚  â€¢ Encrypted with new session keys        â”‚
     â”‚  â€¢ Hash of all handshake messages         â”‚
     â”‚                                           â”‚
     â”œâ”€ Server derives session keys              â”‚
     â”œâ”€ Verifies encrypted Finished message      â”‚
     â”‚                                           â”‚
     â”‚                   (10) ChangeCipherSpec   â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                           â”‚
     â”‚                        (11) Finished      â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚             â€¢ Encrypted confirmation      â”‚
     â”‚                                           â”‚
     â”œâ”€ Client verifies server's Finished        â”‚
     â”‚                                           â”‚
     â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
     â”‚     HANDSHAKE COMPLETE - 2 RTT            â”‚
     â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
     â”‚                                           â”‚
     â”‚  Application Data (HTTP Request)          â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚           ğŸ” Encrypted with AES           â”‚
     â”‚                                           â”‚
     â”‚         Application Data (HTTP Response)  â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚           ğŸ” Encrypted with AES           â”‚
     â”‚                                           â”‚
```

### Timeline Visualization

```
RTT 0    RTT 1                        RTT 2
  â”‚        â”‚                            â”‚
  â”œâ”€ CH â”€â”€>â”‚                            â”‚
  â”‚        â”œâ”€ SH, Cert, SKE, SHD â”€â”€â”€â”€â”€â”€>â”‚
  â”‚        â”‚<â”€ CKE, CCS, Fin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚        â”‚â”€ CCS, Fin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚        â”‚                            â”œâ”€ Data Transfer
  â”‚        â”‚                            â”‚

CH  = ClientHello
SH  = ServerHello
SKE = ServerKeyExchange
SHD = ServerHelloDone
CKE = ClientKeyExchange
CCS = ChangeCipherSpec
Fin = Finished
```

---

## TLS 1.3 Handshake (Optimized)

### Complete Message Flow

```
Client                                     Server
     â”‚                                           â”‚
     â”‚  (1) ClientHello                          â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚  â€¢ Protocol version: TLS 1.3              â”‚
     â”‚  â€¢ Client random                          â”‚
     â”‚  â€¢ Cipher suites                          â”‚
     â”‚  â€¢ Key share (Client's DH public key)     â”‚
     â”‚  â€¢ PSK (if resuming)                      â”‚
     â”‚  â€¢ Extensions                             â”‚
     â”‚                                           â”‚
     â”œâ”€ Server processes ClientHello             â”‚
     â”œâ”€ Selects cipher suite                     â”‚
     â”œâ”€ Generates server DH key pair             â”‚
     â”œâ”€ Derives handshake keys                   â”‚
     â”‚                                           â”‚
     â”‚                          (2) ServerHello  â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     â€¢ Server random       â”‚
     â”‚                     â€¢ Chosen cipher       â”‚
     â”‚                     â€¢ Key share (Server's â”‚
     â”‚                       DH public key)      â”‚
     â”‚                                           â”‚
     â”‚             {Everything below encrypted}  â”‚
     â”‚                                           â”‚
     â”‚                  {3} EncryptedExtensions  â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                           â”‚
     â”‚                     {4} Certificate       â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚              {Server's certificate chain} â”‚
     â”‚                                           â”‚
     â”‚                {5} CertificateVerify      â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚              {Signature over handshake}   â”‚
     â”‚                                           â”‚
     â”‚                      {6} Finished         â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚        {MAC of entire handshake}          â”‚
     â”‚                                           â”‚
     â”œâ”€ Client validates everything              â”‚
     â”œâ”€ Derives application keys                 â”‚
     â”‚                                           â”‚
     â”‚  {7} Finished                             â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚        {Client's handshake MAC}           â”‚
     â”‚                                           â”‚
     â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
     â”‚     HANDSHAKE COMPLETE - 1 RTT! âš¡        â”‚
     â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
     â”‚                                           â”‚
     â”‚  {Application Data}                       â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                           â”‚

{} = Encrypted with handshake keys
```

### Timeline Visualization

```
RTT 0              RTT 1
  â”‚                  â”‚
  â”œâ”€ CH + KeyShare â”€>â”‚
  â”‚                  â”œâ”€ SH, {Cert, CV, Fin}
  â”‚<â”€ {Fin} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                  â”œâ”€ Application Data!
  â”‚                  â”‚

CH  = ClientHello
SH  = ServerHello
CV  = CertificateVerify
Fin = Finished
```

---

## TLS 1.3 with 0-RTT (Session Resumption)

### Even Faster for Repeat Visitors!

```
Client                                     Server
     â”‚                                           â”‚
     â”‚  (1) ClientHello + Early Data             â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚  â€¢ PSK from previous session              â”‚
     â”‚  â€¢ {Application Data}                     â”‚
     â”‚    (encrypted with PSK)                   â”‚
     â”‚                                           â”‚
     â”‚  âš¡ DATA SENT IMMEDIATELY - 0 RTT! âš¡      â”‚
     â”‚                                           â”‚
     â”‚                          (2) ServerHello  â”‚
     â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     {Early Data Accept}   â”‚
     â”‚                     {Finished}            â”‚
     â”‚                     {Application Data}    â”‚
     â”‚                                           â”‚
     â”‚  Full duplex communication established!   â”‚
     â”‚                                           â”‚

Note: 0-RTT has replay attack risks for non-idempotent requests
```

---

## Side-by-Side Comparison

### Speed Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Handshake Duration                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  TLS 1.2:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (2 RTT = ~200ms on 100ms latency)   â”‚
â”‚                                                               â”‚
â”‚  TLS 1.3:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (1 RTT = ~100ms)  âš¡ 50% faster!           â”‚
â”‚                                                               â”‚
â”‚  TLS 1.3   â–ˆâ–ˆâ–ˆ (0-RTT = ~50ms)  âš¡âš¡ 75% faster!              â”‚
â”‚  Resume:                                                      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Message Count

| Version       | Messages Exchanged | Encrypted        |
| ------------- | ------------------ | ---------------- |
| TLS 1.2       | 11 messages        | Last 2 only      |
| TLS 1.3       | 7 messages         | From ServerHello |
| TLS 1.3 0-RTT | 5 messages         | Almost all       |

---

## Key Exchange Methods

### RSA Key Exchange (TLS 1.2 only)

```
Client                                Server
   â”‚                                    â”‚
   â”œâ”€ Generates random pre-master      â”‚
   â”‚  secret                            â”‚
   â”‚                                    â”‚
   â”‚  Pre-master secret                 â”‚
   â”‚  (Encrypted with server's          â”‚
   â”‚   public key from cert)            â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                    â”‚
   â”‚                                    â”œâ”€ Decrypts with
   â”‚                                    â”‚  private key
   â”‚                                    â”‚
   â”œâ”€ Both derive session keys from:   â”‚
   â”‚  â€¢ Pre-master secret               â”‚
   â”‚  â€¢ Client random                   â”‚
   â”‚  â€¢ Server random                   â”‚
   â”‚                                    â”‚

âŒ No Forward Secrecy!
If server's private key leaks, all past sessions compromised!
```

### ECDHE (Recommended - TLS 1.2 & 1.3)

```
Client                                Server
   â”‚                                    â”‚
   â”œâ”€ Generate ephemeral               â”œâ”€ Generate ephemeral
   â”‚  ECDH key pair                    â”‚  ECDH key pair
   â”‚                                    â”‚
   â”‚  Client's public key               â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                    â”‚
   â”‚          Server's public key       â”‚
   â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                                    â”‚
   â”œâ”€ Compute shared secret             â”œâ”€ Compute shared secret
   â”‚  using server's public +           â”‚  using client's public +
   â”‚  own private key                   â”‚  own private key
   â”‚                                    â”‚
   â”œâ”€ Derive session keys               â”œâ”€ Derive session keys
   â”‚                                    â”‚
   â”œâ”€ Discard private keys! ğŸ”¥          â”œâ”€ Discard private keys! ğŸ”¥
   â”‚                                    â”‚

âœ… Perfect Forward Secrecy!
Even if server's long-term key leaks, past sessions safe!
```

---

## Session Resumption Mechanisms

### Session IDs (TLS 1.2)

```
Initial Connection:
Client â”€â”€â”€â”€ ClientHello â”€â”€â”€â”€> Server
Client <â”€â”€â”€ SessionID=123 â”€â”€â”€ Server
       ... full handshake ...

Resumption (within timeout):
Client â”€â”€â”€â”€ ClientHello + SessionID=123 â”€â”€> Server
Client <â”€â”€â”€ Abbreviated Handshake â”€â”€â”€â”€â”€â”€â”€â”€ Server
       (Skips certificate exchange)
```

### Session Tickets (TLS 1.2 & 1.3)

```
Initial Connection:
Client <â”€â”€â”€ Encrypted Session State â”€â”€â”€ Server
       (Encrypted with server's ticket key)

Resumption:
Client â”€â”€â”€â”€ Ticket â”€â”€> Server
Server â”€â”€â”€â”€ Decrypts ticket
       â”€â”€â”€â”€ Validates & resumes
```

### PSK (Pre-Shared Key - TLS 1.3)

```
After first connection:
Client stores: PSK + PSK identity

Resumption:
Client â”€â”€â”€â”€ PSK identity â”€â”€> Server
       â”€â”€â”€â”€ Key Share (for forward secrecy)
Server â”€â”€â”€â”€ Validates PSK
       â”€â”€â”€â”€ Derives keys from PSK + new DH
```

---

## Handshake Failure Scenarios

### Certificate Validation Failure

```
Client                                Server
   â”‚  ClientHello                       â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                    â”‚
   â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚  ServerHello + Certificate         â”‚
   â”‚  (expired / wrong domain)          â”‚
   â”‚                                    â”‚
   â”œâ”€ Validation FAILED! âŒ             â”‚
   â”‚                                    â”‚
   â”‚  Alert: certificate_expired        â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                    â”‚
   â”‚  Connection Terminated             â”‚
   X                                    X

Browser shows: "Your connection is not private"
```

### Cipher Suite Mismatch

```
Client                                Server
   â”‚  ClientHello                       â”‚
   â”‚  Ciphers: [A, B, C]               â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                    â”‚
   â”‚                                    â”œâ”€ Server only supports
   â”‚                                    â”‚  ciphers [X, Y, Z]
   â”‚                                    â”‚
   â”‚  Alert: handshake_failure          â”‚
   â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                                    â”‚
   X  Connection Failed                 X

Error: "ERR_SSL_VERSION_OR_CIPHER_MISMATCH"
```

---

## Best Practices Summary

### âœ… DO

1. **Use TLS 1.3** for new deployments
2. **Enable ECDHE** cipher suites (forward secrecy)
3. **Disable TLS 1.0/1.1** completely
4. **Enable OCSP Stapling** (performance + privacy)
5. **Use session tickets** for resumption
6. **Configure HSTS** header

### âŒ DON'T

1. **Don't use SSL 3.0** (POODLE vulnerable)
2. **Don't use RC4** cipher (broken)
3. **Don't use MD5** (collision attacks)
4. **Don't use RSA key exchange** (no forward secrecy)
5. **Don't allow TLS compression** (CRIME attack)

---

## Quick Debug Commands

```bash
# Test handshake
openssl s_client -connect example.com:443 -tls1_3

# Verbose output
openssl s_client -connect example.com:443 -showcerts -debug

# Test specific cipher
openssl s_client -connect example.com:443 \
  -cipher 'ECDHE-RSA-AES256-GCM-SHA384'

# Check protocol versions supported
for version in ssl3 tls1 tls1_1 tls1_2 tls1_3; do
  echo -n "$version: "
  timeout 1 openssl s_client -connect example.com:443 \
    -$version 2>/dev/null && echo "âœ“" || echo "âœ—"
done
```

---

## Visual Memory Aid

```
TLS 1.2 = TWO round trips  = âœŒï¸
TLS 1.3 = ONE round trip   = â˜ï¸
0-RTT   = ZERO round trips = ğŸ‘Œ
```

---

_Perfect for drawing on a whiteboard during interviews!_

**Last Updated: January 2026**